rules:
- id: redos1
  patterns:
    - pattern-either: 
      - pattern: |
          <...$KEY.$METHOD(/.../,...)...>
      - pattern: |
          <...$KEY.$METHOD(new RegExp('...'),...)...>
    - metavariable-regex:
          metavariable: $METHOD
          regex: (match|replace)
    - pattern-inside: |
        function ...(...,$KEY,...) {
        ...
        }
    - pattern-not-inside: |
        function ...(...,$KEY,...) {
        ...
        if(<...$KEY.length...>)
        ...
        }    

  message: REDOS direct use of match or replace
  severity: WARNING
  languages: [javascript]
  

- id: redos12
  patterns:
    - pattern-either: 
      - pattern: |
          <...$KEY.$METHOD(/.../,...)...>
      - pattern: |
          <...$KEY.$METHOD(new RegExp('...'),...)...>
    - metavariable-regex:
          metavariable: $METHOD
          regex: (match|replace)
    - pattern-inside: |
        function ...(...,$KEY0,...) {
        ...
        $KEY = <... $KEY0 ...>
        ...
        }
    - pattern-not-inside: |
        function ...(...,$KEY0,...) {
        ...
        if(<...$KEY0.length...>)
        ...
        }
    - pattern-not-inside: |
        function ...(...,$KEY0,...) {
        ...
        if(<...$KEY.length...>)
        ...
        }
  message: REDOS match or replace with reassigned argument
  severity: WARNING
  languages: [javascript]

- id: redos2
  patterns:
    - pattern-either: 
      - pattern: |
          <... /.../.$METHOD($KEY) ...>
      - pattern: |
          <... new RegExp('...').$METHOD($KEY) ...>
    - metavariable-regex:
          metavariable: $METHOD
          regex: (exec|test)
    - pattern-inside: |
        function ...(...,$KEY,...) {
        ...
        }
    - pattern-not-inside: |
        function ...(...,$KEY,...) {
        ...
        if(<...$KEY.length...>)
        ...
        }
  message: REDOS direct use of test or exec
  severity: WARNING
  languages: [javascript]

- id: redos22
  patterns:
    - pattern-either: 
      - pattern: |
          <... /.../.$METHOD($KEY) ...>
      - pattern: |
          <... new RegExp('...').$METHOD($KEY) ...>
    - metavariable-regex:
          metavariable: $METHOD
          regex: (exec|test)
    - pattern-inside: |
        function ...(...,$KEY0,...) {
        ...
        $KEY = <... $KEY0 ...>
        ...
        }
    - pattern-not-inside: |
        function ...(...,$KEY0,...) {
        ...
        if(<...$KEY0.length...>)
        ...
        }
    - pattern-not-inside: |
        function ...(...,$KEY0,...) {
        ...
        if(<...$KEY.length...>)
        ...
        }
  message: REDOS use of test or exec with reassigned argument
  severity: WARNING
  languages: [javascript]