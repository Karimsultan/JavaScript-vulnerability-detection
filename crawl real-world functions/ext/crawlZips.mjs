import fs from "fs";
import https from "https"
import fetch from "node-fetch";
import download from "download";


const ids = JSON.parse(fs.readFileSync(process.argv[2]));  // path to the list of the chrome extension id's, crawled with chrome inspect console script (json array format)


async function main() {

    for(const id of ids) {
        const link = `https://clients2.google.com/service/update2/crx?response=redirect&prodversion=91.0.4472.114&x=id%3D${id}%26installsource%3Dondemand%26uc&nacl_arch=x86-64&acceptformat=crx2,crx3`;
        console.log(link);
        try{
            fs.writeFileSync(`./zips/${id}.zip`, await download(link));
        }catch(e) {
            fs.appendFileSync('errors.txt', e + "\n\n")
        }
        
    }
}

main();
